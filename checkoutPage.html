<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="./css/style.css">
    <title>Document</title>
</head>

<body>
    <header>
        <div class="border-bottom p-2 text-center">
            <h6 class="colorccc">Welcome to our store</h6>
        </div>

        <div class="checkoutcarticon d-none" id="checkoutpageId">
            <a href="./checkoutPage.html"><img src="./assets/checkout.png" width="30" alt=""></a>
            <span class="checkoutcount" id="checkoutcounT2"></span>
        </div>

        <div class="">
            <nav class="navbar navbar-expand-lg navbar-light bg-light">
                <div class="container-fluid">
                    <a class="navbar-brand" href="./index.html"><img src="./assets/logo.png" width="90" alt=""></a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" href="/">
                                    <p class="mb-0 font14px">Home</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="./product.html">
                                    <p class="mb-0 font14px">Catalog</p>
                                </a>
                            </li>

                            <li class="nav-item">
                                <a class="nav-link" href="./contactUs.html">
                                    <p class="mb-0 font14px    ">Contact</p>
                                </a>
                            </li>

                        </ul>
                        <div class=" d-none" id="checkoutpageId2">
                            <a href="./checkoutPage.html"><img src="./assets/checkout.png" width="30" alt=""></a>
                            <span class="checkoutcount" id="checkoutcounT"></span>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </header>


    <section class=" border-bottom  checkoutsection  checkoutcontainersection">

        <div class="container-fluid ps-4">
            <div class="d-flex productscreen">
                <div class="productboxwidth py-5 pb-5">
                    <div class="mb-2">
                        <button type="button" id="Continue" class="btn btn-success fs-6" data-bs-toggle="modal"
                            data-bs-target="#exampleModal">Continue</button>
                    </div>

                    <div class="row" id="checkouwrapper">

                    </div>
                </div>

                <div class="amountDEtails p-4 px-2 ms-2">
                    <h6 class="font700">Details</h6>
                    <p class="mb-2 lh-1 font14px" id="itemsT">Total Items:</p>
                    <p class="mb-2 lh-1 font14px" id="Delivery">Delivery Fees:</p>
                    <p class="mb-0 lh-1 font14px" id="coupon">coupon : No</p>
                    <span class="font11px lh-1 font700 mb-4 d-inline-block font8px">If you buy above ₹999, delivery is
                        free</span>
                    <h6 id="AmountT">Total Mount:</h6>
                </div>
            </div>





        </div>
    </section>

    <footer>
        <div class="container-fluid px-5 py-4">
            <div class="d-flex aling-items-center">
                <p class="copyright mb-0 color#ccc">© 2024, My Store Powered by KIVI
                </p>

                <p class=" copyright mb-0 ps-4 colorccc"><a href="./returnpolicy.html" class="text-dark">Return Policy</a></p>
            </div>
        </div>
    </footer>















    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel"><img src="./assets/logo.png" width="100" alt="">
                    </h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="contact-form">
                        <span class="circle one"></span>
                        <span class="circle two"></span>

                        <div class="forminner" autocomplete="off">
                            <h3 class="title">Info</h3>
                            <div class="input-container">
                                <input type="text" name="name" id="name" class="input" />
                                <label for="">Username</label>
                                <span>Username</span>
                            </div>
                            <div class="input-container">
                                <input type="email" name="email" id="email" class="input" />
                                <label for="">Email</label>
                                <span>Email</span>
                            </div>
                            <div class="input-container">
                                <input type="tel" name="phone" id="number" class="input" />
                                <label for="">Phone</label>
                                <span>Phone</span>
                            </div>
                            <div class="input-container textarea">
                                <textarea name="message" id="address" class="input"></textarea>
                                <label for="">Full Address</label>
                                <span>Full Address</span>
                            </div>
                            <input type="button" class="w-100 p-2 submitButton border-0" value="Pay" class="btn"
                                onclick="orderplace(this)" />
                            <div class="d-flex align-items-center justify-content-center">
                                <div class="spinner-border text-primary" role="status" id="spinner">
                                </div>
                            </div>

                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
        crossorigin="anonymous"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
    </script>
    <script src="./js/index.js"></script>


    <script type="text/javascript">
        (function () {
            emailjs.init({
                publicKey: "rvZRnI7kUBqB9Z4PH",
            });
        })();
    </script>
    <script>
        function orderplace(val) {

            

            if( document.getElementById("email").value.length>4 &&  document.getElementById("number").value>9 &&  document.getElementById("address").value.length >0 &&document.getElementById("name").value.length >0 ){
                val.style.display = "none"
            document.getElementById("spinner").style.display = "block"
            setTimeout(() => {
                document.getElementById("exampleModal").style.display = "none"
            }, 2000)
                paytome()
            }

            else[
                alert("Please Recheck All Field")
            ]
           
        }

    </script>



    <script>
        const inputs = document.querySelectorAll(".input");

        function focusFunc() {
            let parent = this.parentNode;
            parent.classList.add("focus");
        }

        function blurFunc() {
            let parent = this.parentNode;
            if (this.value == "") {
                parent.classList.remove("focus");
            }
        }

        inputs.forEach((input) => {
            input.addEventListener("focus", focusFunc);
            input.addEventListener("blur", blurFunc);
        });

    </script>

    <script>
        function addCard() {

            if (localStorage.getItem("ProductKey")) {

                JSON.parse(localStorage.getItem("ProductKey")).forEach((element, index) => {



                    var newElement = document.createElement('div');
                    let html = ` <div class="col-md-3 mb-4 position-relative myElement" data-product='${element?.id}'>
            <div>
                <img src='${element?.img}' class="w-100 productimg" alt="">
            </div>

            <div class="pt-2 detailsbox">
                <div class="">
                    <p class="mb-0">Oversized tshirt</p>
                    <p class="mb-0">Color : '${element?.color}'</p>
                    <p class="mb-0">Selected size : ${element?.size}</p>
                </div>
                    
                <p class="mb-0 font700 colorccc">'${element?.price}'</p>
                      
            </div>
            <div class="input-group mt-3  w-auto justify-content-end align-items-center">
<input type="button"  id='${element?.id + "minus"}' value="-" class="button-minus border rounded-circle  icon-shape icon-sm mx-1 " data-field="quantity">
<input type="number" step="1" max="10" value='${element.count}' name="quantity" class="quantity-field border-0 text-center w-25">
<input type="button"   id='${element?.id + "plus"}' value="+" class="button-plus border rounded-circle icon-shape icon-sm " data-field="quantity">
</div>

           
             <img src="./assets/delete.png" class="deletepro" width="10" onclick="deleteitem('${element?.id}')" alt="">
        </div>`
                    if (document.getElementById("checkouwrapper")) {
                        document.getElementById("checkouwrapper").insertAdjacentHTML('beforeend', html);
                    }
                });
            }

            try {
                if (JSON.parse(localStorage.getItem("ProductKey")).length > 0) {
                    document.getElementById("Continue").style.display = "block"
                }
            } catch (error) {
                console.log(error)
            }


            let totalAmount = 0;
            let products = JSON.parse(localStorage.getItem("ProductKey"));

            for (let index = 0; index < products.length; index++) {
                totalAmount += parseInt(products[index].staticprice);
            }

            document.getElementById("AmountT").innerHTML = "Total Amount: ₹" + totalAmount;

            document.getElementById("itemsT").innerHTML = "Total Items : " + products.length

            if (totalAmount > 999) {
                document.getElementById("Delivery").innerHTML = "Delivery Fees: 0"
            }
            else {
                document.getElementById("Delivery").innerHTML = "Delivery Fees: ₹50"
            }


        }


        addCard()



        function incrementValue(e) {
            e.preventDefault();

            var fieldName = $(e.target).data("field");
            var parent = $(e.target).closest("div");
            var currentVal = parseInt(
                parent.find("input[name=" + fieldName + "]").val(),
                10
            );

            if (!isNaN(currentVal)) {
                parent.find("input[name=" + fieldName + "]").val(currentVal + 1);
            } else {
                parent.find("input[name=" + fieldName + "]").val(0);
            }

            let storedProducts = JSON.parse(localStorage.getItem('ProductKey')) || [];

            for (let i = 0; i < storedProducts.length; i++) {
                if (storedProducts[i].id === e.target.id.split("plus")[0]) {
                    // Update the count if the ID matches
                    storedProducts[i].count += 1;
                    let static = storedProducts[i].price
                    storedProducts[i].staticprice += static

                    productFound = true;
                    break;
                }
            }

            localStorage.setItem('ProductKey', JSON.stringify(storedProducts));
            location.reload()
        }

        function decrementValue(e) {
            e.preventDefault();
            var fieldName = $(e.target).data("field");
            var parent = $(e.target).closest("div");
            var currentVal = parseInt(
                parent.find("input[name=" + fieldName + "]").val(),
                10
            );

            if (!isNaN(currentVal) && currentVal > 0) {
                parent.find("input[name=" + fieldName + "]").val(currentVal - 1);
            } else {
                parent.find("input[name=" + fieldName + "]").val(0);
            }

            let storedProducts = JSON.parse(localStorage.getItem('ProductKey')) || [];

            for (let i = 0; i < storedProducts.length; i++) {
                if (storedProducts[i].id === e.target.id.split("minus")[0]) {
                    // Update the count if the ID matches
                    if (storedProducts[i].count >= 2) {
                        storedProducts[i].count -= 1;
                        let static = storedProducts[i].price
                        storedProducts[i].staticprice -= static
                        productFound = true;
                        break;
                    }
                    else if (storedProducts[i].id === e.target.id.split("minus")[0]) {
                        if (storedProducts[i].count <= 1) {
                            storedProducts.splice(i, 1);
                            location.reload();

                        }

                    }

                }
            }

            localStorage.setItem('ProductKey', JSON.stringify(storedProducts));
            location.reload()
        }

        $(".input-group").on("click", ".button-plus", function (e) {

            incrementValue(e);

        });

        $(".input-group").on("click", ".button-minus", function (e) {
            decrementValue(e);
        });

    </script>



    <!-- <button id="rzp-button1">Pay</button> -->

    <script>
        function paytome() {
 
            let productsend = []
            JSON.parse(localStorage.getItem('ProductKey')).forEach(element => {
                productsend.push([element.id,
                element.count, element.size, element.staticprice])
            });

            setTimeout(() => {
                var options = {
                    "key": "rzp_test_4PPvhs3yBHgmFh",
                    "amount": productsend[0][3],
                    "currency": "INR",
                    "name": "Merchant Name",
                    "description": "Purchase Description",
                    "image": "https://example.com/your_logo",
                    "handler": function (response) {
                        alert("Payment Successful!");
                        emailjs.send("service_8cyktrv", "template_cjzh1zy", {
                            from_name: [document.getElementById("name").value,response.razorpay_payment_id],
                            from_email: document.getElementById("email").value,
                            message: document.getElementById("address").value,
                            from_number: document.getElementById("number").value,
                            from_order: productsend,
                        });
                        setTimeout(() => {
                            localStorage.clear();
                            window.location.href = "./thankyou.html";
                        }, 2000)

                        // Send payment details to the server
                        fetch('/your-server-endpoint', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                payment_id: response.razorpay_payment_id,
                                order_id: response.razorpay_order_id,
                                signature: response.razorpay_signature
                            })
                        }).then(response => {
                            // Handle server response
                        }).catch(error => {
                            console.error("Error processing payment:", error);
                        });
                    }
                };

                var rzp1 = new Razorpay(options);
                rzp1.open();
            }, 2000)
        }
    </script>
</body>

</html>